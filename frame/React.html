<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>React | 前端</title><meta name="description" content="我的前端笔记">
    <link rel="preload" href="/blogs/assets/style-C1FtT-lw.css" as="style"><link rel="stylesheet" href="/blogs/assets/style-C1FtT-lw.css">
    <link rel="modulepreload" href="/blogs/assets/app-Cqb5tvJn.js"><link rel="modulepreload" href="/blogs/assets/React.html-D3bFd3dg.js">
    <link rel="prefetch" href="/blogs/assets/index.html-Cyl7MNkL.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DgVGykoY.js" as="script"><link rel="prefetch" href="/blogs/assets/LRU缓存.html-qxt_zVB9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CrC043xF.js" as="script"><link rel="prefetch" href="/blogs/assets/加减乘除带括号.html-BjRipfLx.js" as="script"><link rel="prefetch" href="/blogs/assets/基础排序.html-BUkxAZ6F.js" as="script"><link rel="prefetch" href="/blogs/assets/斐波那列.html-pD52glw9.js" as="script"><link rel="prefetch" href="/blogs/assets/树和对象转换.html-DEOG64Zr.js" as="script"><link rel="prefetch" href="/blogs/assets/1_1_nextjs项目开发.html-Bw5_426b.js" as="script"><link rel="prefetch" href="/blogs/assets/1_2_nextjs项目部署.html-EIXciydd.js" as="script"><link rel="prefetch" href="/blogs/assets/React使用中遇到的一些问题.html-CJ6AkD8Y.js" as="script"><link rel="prefetch" href="/blogs/assets/React构建create-react-app简单说明.html-D6WmRa2j.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-MDbaHaKk.js" as="script"><link rel="prefetch" href="/blogs/assets/ubuntu使用.html-BW3nv-KH.js" as="script"><link rel="prefetch" href="/blogs/assets/vue.init.html-BiOC4uyU.js" as="script"><link rel="prefetch" href="/blogs/assets/vue.use.html-BpY9CXMM.js" as="script"><link rel="prefetch" href="/blogs/assets/vuex源码解析.html-BQ-wH_-w.js" as="script"><link rel="prefetch" href="/blogs/assets/Vue使用中遇到的一些问题.html-hHZmy48A.js" as="script"><link rel="prefetch" href="/blogs/assets/vue梳理.html-DASOhSB3.js" as="script"><link rel="prefetch" href="/blogs/assets/watcher__dep.html-Mo2A8RGz.js" as="script"><link rel="prefetch" href="/blogs/assets/代码片段.html-DQ7RN04J.js" as="script"><link rel="prefetch" href="/blogs/assets/打包.html-x9hRmfYe.js" as="script"><link rel="prefetch" href="/blogs/assets/简单双向绑定.html-C3RzwaGy.js" as="script"><link rel="prefetch" href="/blogs/assets/纯函数.html-Cwik8IWX.js" as="script"><link rel="prefetch" href="/blogs/assets/parseInt.html-_Qr38UUM.js" as="script"><link rel="prefetch" href="/blogs/assets/preventDefault报错.html-CcLEKDD5.js" as="script"><link rel="prefetch" href="/blogs/assets/promise.html-3RUUJ3zJ.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-lfACA1Ne.js" as="script"><link rel="prefetch" href="/blogs/assets/requestIdleCallback.html-BWVoOlrL.js" as="script"><link rel="prefetch" href="/blogs/assets/undefined.html-7hGAvhg5.js" as="script"><link rel="prefetch" href="/blogs/assets/webworker.html-CEKVM7Rv.js" as="script"><link rel="prefetch" href="/blogs/assets/代码块.html-DKkuAhdu.js" as="script"><link rel="prefetch" href="/blogs/assets/前后端自动刷新.html-EYvZv4ln.js" as="script"><link rel="prefetch" href="/blogs/assets/多个标签页通讯.html-DUpBB2qP.js" as="script"><link rel="prefetch" href="/blogs/assets/实现个简单爬虫.html-CJzxP9-F.js" as="script"><link rel="prefetch" href="/blogs/assets/执行上下文.html-CcXn08oQ.js" as="script"><link rel="prefetch" href="/blogs/assets/控制台.html-BD8c_5QC.js" as="script"><link rel="prefetch" href="/blogs/assets/查找文件中的图片并下载.html-BeslQ_RP.js" as="script"><link rel="prefetch" href="/blogs/assets/深度广度优先.html-BZ-Jcm5X.js" as="script"><link rel="prefetch" href="/blogs/assets/累加函数.html-BMZumza2.js" as="script"><link rel="prefetch" href="/blogs/assets/触摸事件和键盘事件.html-CEKJ7Eo9.js" as="script"><link rel="prefetch" href="/blogs/assets/css.html-Cs3fcNTc.js" as="script"><link rel="prefetch" href="/blogs/assets/flex.html-Alm0d1Kn.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BDAhVWl0.js" as="script"><link rel="prefetch" href="/blogs/assets/Vue组件样式修改.html-BZeGRkBJ.js" as="script"><link rel="prefetch" href="/blogs/assets/水位.html-D5fAwByL.js" as="script"><link rel="prefetch" href="/blogs/assets/自定义属性.html-Bxtj1dvc.js" as="script"><link rel="prefetch" href="/blogs/assets/eslint.html-B7yQf3x2.js" as="script"><link rel="prefetch" href="/blogs/assets/git.html-DCM2cl3W.js" as="script"><link rel="prefetch" href="/blogs/assets/github访问.html-Z9M9WsGs.js" as="script"><link rel="prefetch" href="/blogs/assets/jenkins.html-Cd74lVDS.js" as="script"><link rel="prefetch" href="/blogs/assets/linux.html-Cx42WzDH.js" as="script"><link rel="prefetch" href="/blogs/assets/make.html-BID5q2W5.js" as="script"><link rel="prefetch" href="/blogs/assets/Markdown基本写法.html-B42FmOcO.js" as="script"><link rel="prefetch" href="/blogs/assets/mysql安装.html-CvOFT7Qj.js" as="script"><link rel="prefetch" href="/blogs/assets/nginx.html-Bmdlb8qr.js" as="script"><link rel="prefetch" href="/blogs/assets/node安装.html-BHW8RaL_.js" as="script"><link rel="prefetch" href="/blogs/assets/php安装.html-DKcNXlbM.js" as="script"><link rel="prefetch" href="/blogs/assets/rabbitMQ.html-CjJVdMgd.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Cwr-D3Wt.js" as="script"><link rel="prefetch" href="/blogs/assets/typescript.html-Baszq9fm.js" as="script"><link rel="prefetch" href="/blogs/assets/vuepress搭建.html-B0Dirdx9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-C-e6YH8J.js" as="script"><link rel="prefetch" href="/blogs/assets/弧度.html-W4cia-I4.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-0NqYYT-d.js" as="script"><link rel="prefetch" href="/blogs/assets/元素分组.html-AnvecFqd.js" as="script"><link rel="prefetch" href="/blogs/assets/元素定位.html-CzZYSpLm.js" as="script"><link rel="prefetch" href="/blogs/assets/元素层级.html-wy0jkqH1.js" as="script"><link rel="prefetch" href="/blogs/assets/元素禁止事件.html-mP_xEnzU.js" as="script"><link rel="prefetch" href="/blogs/assets/元素选中样式.html-DA1wYbgh.js" as="script"><link rel="prefetch" href="/blogs/assets/变换.html-xbhNvx-g.js" as="script"><link rel="prefetch" href="/blogs/assets/图片.html-DQhtaZJr.js" as="script"><link rel="prefetch" href="/blogs/assets/背景图.html-CurOsiZb.js" as="script"><link rel="prefetch" href="/blogs/assets/反序列化.html-BJMh0mlY.js" as="script"><link rel="prefetch" href="/blogs/assets/输出JSON.html-CP30SXwT.js" as="script"><link rel="prefetch" href="/blogs/assets/输出png.html-o6JENSYO.js" as="script"><link rel="prefetch" href="/blogs/assets/输出svg.html-DuYwRUwA.js" as="script"><link rel="prefetch" href="/blogs/assets/三角形.html-DGMOj3tM.js" as="script"><link rel="prefetch" href="/blogs/assets/圆形.html-DmPsPpav.js" as="script"><link rel="prefetch" href="/blogs/assets/多边形.html-CsfTojMa.js" as="script"><link rel="prefetch" href="/blogs/assets/折线.html-6iDI0ppK.js" as="script"><link rel="prefetch" href="/blogs/assets/椭圆.html-GwKphoY1.js" as="script"><link rel="prefetch" href="/blogs/assets/直线.html-D4aFXTLr.js" as="script"><link rel="prefetch" href="/blogs/assets/矩形.html-A-5yyb0h.js" as="script"><link rel="prefetch" href="/blogs/assets/路径.html-hzaVCE3t.js" as="script"><link rel="prefetch" href="/blogs/assets/可编辑文本.html-B4LPn2F2.js" as="script"><link rel="prefetch" href="/blogs/assets/多行文本.html-D0AEbDup.js" as="script"><link rel="prefetch" href="/blogs/assets/文本.html-DiqON_zH.js" as="script"><link rel="prefetch" href="/blogs/assets/文本省略.html-E-eHqykG.js" as="script"><link rel="prefetch" href="/blogs/assets/文本边框.html-CfD34uOE.js" as="script"><link rel="prefetch" href="/blogs/assets/画布拖动和缩放.html-P0BK3YYM.js" as="script"><link rel="prefetch" href="/blogs/assets/画布框选样式.html-jmVi227A.js" as="script"><link rel="prefetch" href="/blogs/assets/fabric.Canvas.html-DRmNLfeC.js" as="script"><link rel="prefetch" href="/blogs/assets/fabric.Circle.html-BIrU6TZM.js" as="script"><link rel="prefetch" href="/blogs/assets/fabric类的继承体系.html-Bf2N8Gud.js" as="script"><link rel="prefetch" href="/blogs/assets/fabric-echarts-demo.html-DIu41rhc.js" as="script"><link rel="prefetch" href="/blogs/assets/拓扑图一.html-CEWB361-.js" as="script"><link rel="prefetch" href="/blogs/assets/拓扑图二.html-BnJb2pGI.js" as="script"><link rel="prefetch" href="/blogs/assets/404.html-DBNhZvRF.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blogs/"><img class="vp-site-logo" src="/blogs/ya.jpg" alt="前端"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">前端</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/fabric/" aria-label="fabric"><!--[--><!--[--><!--]--><!--]-->fabric<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/jsBlock/" aria-label="jsBlock"><!--[--><!--[--><!--]--><!--]-->jsBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/styleBlock/" aria-label="styleBlock"><!--[--><!--[--><!--]--><!--]-->styleBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/svgBlock/" aria-label="svgBlock"><!--[--><!--[--><!--]--><!--]-->svgBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/tools/" aria-label="工具其他"><!--[--><!--[--><!--]--><!--]-->工具其他<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/blogs/frame/" aria-label="Vue、React相关"><!--[--><!--[--><!--]--><!--]-->Vue、React相关<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/webgl/" aria-label="webgl"><!--[--><!--[--><!--]--><!--]-->webgl<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zhuanwan/blogs" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/fabric/" aria-label="fabric"><!--[--><!--[--><!--]--><!--]-->fabric<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/jsBlock/" aria-label="jsBlock"><!--[--><!--[--><!--]--><!--]-->jsBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/styleBlock/" aria-label="styleBlock"><!--[--><!--[--><!--]--><!--]-->styleBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/svgBlock/" aria-label="svgBlock"><!--[--><!--[--><!--]--><!--]-->svgBlock<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/tools/" aria-label="工具其他"><!--[--><!--[--><!--]--><!--]-->工具其他<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/blogs/frame/" aria-label="Vue、React相关"><!--[--><!--[--><!--]--><!--]-->Vue、React相关<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/webgl/" aria-label="webgl"><!--[--><!--[--><!--]--><!--]-->webgl<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zhuanwan/blogs" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/1_1_nextjs%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91.html" aria-label="1_1_nextjs项目开发"><!--[--><!--[--><!--]--><!--]-->1_1_nextjs项目开发<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/1_2_nextjs%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2.html" aria-label="1_2_nextjs项目部署"><!--[--><!--[--><!--]--><!--]-->1_2_nextjs项目部署<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/blogs/frame/React.html" aria-label="React"><!--[--><!--[--><!--]--><!--]-->React<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/React%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html" aria-label="React使用中遇到的一些问题"><!--[--><!--[--><!--]--><!--]-->React使用中遇到的一些问题<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/React%E6%9E%84%E5%BB%BAcreate-react-app%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E.html" aria-label="React构建create-react-app简单说明"><!--[--><!--[--><!--]--><!--]-->React构建create-react-app简单说明<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/ubuntu%E4%BD%BF%E7%94%A8.html" aria-label="ubuntu使用"><!--[--><!--[--><!--]--><!--]-->ubuntu使用<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/vue.init.html" aria-label="vue.init"><!--[--><!--[--><!--]--><!--]-->vue.init<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/vue.use.html" aria-label="vue.use"><!--[--><!--[--><!--]--><!--]-->vue.use<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/vuex%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html" aria-label="vuex源码解析"><!--[--><!--[--><!--]--><!--]-->vuex源码解析<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/Vue%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html" aria-label="Vue使用中遇到的一些问题"><!--[--><!--[--><!--]--><!--]-->Vue使用中遇到的一些问题<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/vue%E6%A2%B3%E7%90%86.html" aria-label="vue梳理"><!--[--><!--[--><!--]--><!--]-->vue梳理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/watcher__dep.html" aria-label="watcher&amp;&amp;dep"><!--[--><!--[--><!--]--><!--]-->watcher&amp;&amp;dep<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5.html" aria-label="代码片段"><!--[--><!--[--><!--]--><!--]-->代码片段<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/%E6%89%93%E5%8C%85.html" aria-label="打包"><!--[--><!--[--><!--]--><!--]-->打包<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/%E7%AE%80%E5%8D%95%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A.html" aria-label="简单双向绑定"><!--[--><!--[--><!--]--><!--]-->简单双向绑定<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/blogs/frame/%E7%BA%AF%E5%87%BD%E6%95%B0.html" aria-label="纯函数"><!--[--><!--[--><!--]--><!--]-->纯函数<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="react" tabindex="-1"><a class="header-anchor" href="#react"><span>React</span></a></h1><h2 id="jsx" tabindex="-1"><a class="header-anchor" href="#jsx"><span>jsx</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jsx本质上就是React.createElement的语法糖，调用createElement生成对象，所以需要import React from &#39;react&#39;</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;Hello world&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>react17可以不用import React，React 17 在 React 的 package 中引入了两个新入口，这些入口只会被 Babel 和 TypeScript 等编译器使用。新的 JSX 转换不会将 JSX 转换为 React.createElement，而是自动从 React 的 package 中引入新的入口函数并调用</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 由编译器引入（禁止自己引入！）</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>jsx <span class="token keyword">as</span> _jsx<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react/jsx-runtime&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;Hello world&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目前，旧的转换的默认选项为 {&quot;runtime&quot;: &quot;classic&quot;}。如需启用新的转换，你可以使用 {&quot;runtime&quot;: &quot;automatic&quot;} 作为 @babel/plugin-transform-react-jsx 或 @babel/preset-react 的选项</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 如果你使用的是 @babel/preset-react</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;automatic&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例https://codesandbox.io/s/didact-8-21ost中, 添加/** @jsxRuntime classic */，以便使用自定义的createElement</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"></span>
<span class="line"><span class="token doc-comment comment">/** <span class="token keyword">@jsxRuntime</span> classic */</span></span>
<span class="line"><span class="token doc-comment comment">/** <span class="token keyword">@jsx</span> Didact.createElement */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> Didact<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">...</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="reactdom-render" tabindex="-1"><a class="header-anchor" href="#reactdom-render"><span>ReactDOM.render</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> container<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=</span></span>
<span class="line"><span class="token function">legacyRenderSubtreeIntoContainer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 生成root</span></span>
<span class="line">  root <span class="token operator">=</span> </span>
<span class="line">  container<span class="token punctuation">.</span>_reactRootContainer <span class="token operator">=</span> </span>
<span class="line">  <span class="token function">legacyCreateRootFromDOMContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line">  <span class="token function">createLegacyRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">ReactDOMBlockingRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">_internalRoot</span><span class="token operator">:</span> <span class="token function">createRootImpl</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line">                    <span class="token function">createContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=</span></span>
<span class="line">                    <span class="token function">createFiberRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=</span></span>
<span class="line">                    <span class="token punctuation">{</span></span>
<span class="line">                      root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FiberRootNode</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">tag</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">containerInfo</span><span class="token operator">:</span> container<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">}</span></span>
<span class="line">                      root<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FiberNode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">tag</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token number">0</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token literal-property property">stateNode</span><span class="token operator">:</span> root<span class="token punctuation">,</span> <span class="token literal-property property">updateQueue</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                      <span class="token keyword">return</span> root</span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    </span>
<span class="line">    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span></span>
<span class="line">    <span class="token function-variable function">unmount</span><span class="token operator">:</span> <span class="token keyword">function</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// 生成fibreRoot</span></span>
<span class="line">  fiberRoot <span class="token operator">=</span> root<span class="token punctuation">.</span>_internalRoot</span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 这里细节没看懂</span></span>
<span class="line">  <span class="token function">unbatchedUpdates</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">updateContainer</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> fiberRoot<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  updateContainer <span class="token operator">-</span><span class="token operator">&gt;</span> scheduleUpdateOnFiber <span class="token operator">-</span><span class="token operator">&gt;</span> performSyncWorkOnRoot <span class="token operator">-</span><span class="token operator">&gt;</span> renderRootSync <span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// workInProgressRoot = fiberRoot</span></span>
<span class="line">    <span class="token comment">// workInProgress = fiberRoot.current = fiberRoot.current.alternate</span></span>
<span class="line">    prepareFreshStack <span class="token operator">-</span><span class="token operator">&gt;</span> createWorkInProgress</span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 执行单元</span></span>
<span class="line">    workLoopSync <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> beginWork <span class="token operator">-</span><span class="token operator">&gt;</span> completeUnitOfWork</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">_internalRoot</span><span class="token operator">:</span> <span class="token function">createRootImpl</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function-variable function">unmount</span><span class="token operator">:</span> <span class="token keyword">function</span></span>
<span class="line">  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token function">updateContainer</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> root<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">=</span> </span>
<span class="line"></span>
<span class="line"><span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>current$1<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>current$1<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="diff" tabindex="-1"><a class="header-anchor" href="#diff"><span>diff</span></a></h2><h3 id="reconcilesingleelement" tabindex="-1"><a class="header-anchor" href="#reconcilesingleelement"><span>reconcileSingleElement</span></a></h3><ul><li>当 child !== null 且 key 相同且 type 不同时执行 deleteRemainingChildren 将 child 及其兄弟 fiber 都标记删除。</li><li>当 child !== null 且 key 不同时仅将 child 标记删除。</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">  <span class="token comment">// 当前页面显示的</span></span>
<span class="line">  ul <span class="token operator">&gt;</span> li <span class="token operator">*</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 这次需要更新的</span></span>
<span class="line">  ul <span class="token operator">&gt;</span> p</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于本次更新时只有一个 p，属于单一节点的 Diff，会走上面介绍的代码逻辑。</p><p>在 reconcileSingleElement 中遍历之前的 3 个 fiber（对应的 DOM 为 3 个 li），寻找本次更新的 p 是否可以复用之前的 3 个 fiber 中某个的 DOM。</p><p>当 key 相同且 type 不同时，代表我们已经找到本次更新的 p 对应的上次的 fiber，但是 p 与 li type 不同，不能复用。既然唯一的可能性已经不能复用，则剩下的 fiber 都没有机会了，所以都需要标记删除。</p><p>当 key 不同时只代表遍历到的该 fiber 不能被 p 复用，后面还有兄弟 fiber 还没有遍历到。所以仅仅标记该 fiber 删除。</p><h3 id="reconcilechildrenarray" tabindex="-1"><a class="header-anchor" href="#reconcilechildrenarray"><span>reconcileChildrenArray</span></a></h3><p>第一轮遍历步骤如下：</p><ol><li>let i = 0，遍历 newChildren，将 newChildren[i] 与 oldFiber 比较，判断 DOM 节点是否可复用。</li><li>如果可复用，i++，继续比较 newChildren[i] 与 oldFiber.sibling，可以复用则继续遍历。</li><li>如果不可复用，分两种情况：</li><li>key 不同导致不可复用，立即跳出整个遍历，第一轮遍历结束。</li><li>key 相同 type 不同导致不可复用，会将 oldFiber 标记为 DELETION，并继续遍历</li><li>如果 newChildren 遍历完（即 i === newChildren.length - 1）或者 oldFiber 遍历完（即 oldFiber.sibling === null），跳出遍历，第一轮遍历结束。</li></ol><p>第一轮遍历完后：</p><ul><li>newChildren 和 oldFiber 都遍历完，结束</li><li>newChildren 遍历完，oldFiber 没遍历完，遍历剩下的 oldFiber，依次标记 Deletion。</li><li>newChildren 没遍历完，oldFiber 遍历完，遍历剩下的 newChildren 为生成的 workInProgress fiber 依次标记 Placement。</li></ul><p>newChildren 与 oldFiber 都没遍历完:<br> 第二轮遍历步骤如下：</p><ol><li>将所有还未处理的 oldFiber 存入以 key 为 key，oldFiber 为 value 的 Map（existingChildren ） 中。</li><li>最后一个可复用的节点在 oldFiber 中的位置索引（用变量 lastPlacedIndex 表示）。</li><li>用变量 oldIndex 表示遍历到的可复用节点在 oldFiber 中的位置索引。如果 oldIndex &lt; lastPlacedIndex，代表本次更新该节点需要向右移动。</li><li>lastPlacedIndex 初始为 0，每遍历一个可复用的节点，如果 oldIndex &gt;= lastPlacedIndex，则 lastPlacedIndex = oldIndex。</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 之前</span></span>
<span class="line">abcd</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 之后</span></span>
<span class="line">acdb</span>
<span class="line"></span>
<span class="line"><span class="token operator">===</span>第一轮遍历开始<span class="token operator">===</span></span>
<span class="line">a（之后）vs a（之前）</span>
<span class="line">key 不变，可复用</span>
<span class="line">此时 a 对应的 oldFiber（之前的 a）在之前的数组（abcd）中索引为 <span class="token number">0</span></span>
<span class="line">所以 lastPlacedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">继续第一轮遍历<span class="token operator">...</span></span>
<span class="line"></span>
<span class="line">c（之后）vs b（之前）</span>
<span class="line">key 改变，不能复用，跳出第一轮遍历</span>
<span class="line">此时 lastPlacedIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">===</span>第一轮遍历结束<span class="token operator">===</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">===</span>第二轮遍历开始<span class="token operator">===</span></span>
<span class="line">newChildren <span class="token operator">===</span> cdb，没用完，不需要执行删除旧节点</span>
<span class="line">oldFiber <span class="token operator">===</span> bcd，没用完，不需要执行插入新节点</span>
<span class="line"></span>
<span class="line">将剩余 oldFiber（bcd）保存为 map</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当前 oldFiber：bcd</span></span>
<span class="line"><span class="token comment">// 当前 newChildren：cdb</span></span>
<span class="line"></span>
<span class="line">继续遍历剩余 newChildren</span>
<span class="line"></span>
<span class="line">key <span class="token operator">===</span> c 在 oldFiber 中存在</span>
<span class="line"><span class="token keyword">const</span> oldIndex <span class="token operator">=</span> c（之前）<span class="token punctuation">.</span>index<span class="token punctuation">;</span></span>
<span class="line">此时 oldIndex <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 之前节点为 abcd，所以c.index === 2</span></span>
<span class="line">比较 oldIndex 与 lastPlacedIndex<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">如果 oldIndex <span class="token operator">&gt;=</span> lastPlacedIndex 代表该可复用节点不需要移动</span>
<span class="line">并将 lastPlacedIndex <span class="token operator">=</span> oldIndex<span class="token punctuation">;</span></span>
<span class="line">如果 oldIndex <span class="token operator">&lt;</span> lastplacedIndex 该可复用节点之前插入的位置索引小于这次更新需要插入的位置索引，代表该节点需要向右移动</span>
<span class="line"></span>
<span class="line">在例子中，oldIndex <span class="token number">2</span> <span class="token operator">&gt;</span> lastPlacedIndex <span class="token number">0</span>，</span>
<span class="line">则 lastPlacedIndex <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">c 节点位置不变</span>
<span class="line"></span>
<span class="line">继续遍历剩余 newChildren</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当前oldFiber：bd</span></span>
<span class="line"><span class="token comment">// 当前newChildren：db</span></span>
<span class="line"></span>
<span class="line">key <span class="token operator">===</span> d 在 oldFiber 中存在</span>
<span class="line"><span class="token keyword">const</span> oldIndex <span class="token operator">=</span> d（之前）<span class="token punctuation">.</span>index<span class="token punctuation">;</span></span>
<span class="line">oldIndex <span class="token number">3</span> <span class="token operator">&gt;</span> lastPlacedIndex <span class="token number">2</span> <span class="token comment">// 之前节点为 abcd，所以 d.index === 3</span></span>
<span class="line">则 lastPlacedIndex <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">d 节点位置不变</span>
<span class="line"></span>
<span class="line">继续遍历剩余 newChildren</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当前 oldFiber：b</span></span>
<span class="line"><span class="token comment">// 当前 newChildren：b</span></span>
<span class="line"></span>
<span class="line">key <span class="token operator">===</span> b 在 oldFiber 中存在</span>
<span class="line"><span class="token keyword">const</span> oldIndex <span class="token operator">=</span> b（之前）<span class="token punctuation">.</span>index<span class="token punctuation">;</span></span>
<span class="line">oldIndex <span class="token number">1</span> <span class="token operator">&lt;</span> lastPlacedIndex <span class="token number">3</span> <span class="token comment">// 之前节点为 abcd，所以 b.index === 1</span></span>
<span class="line">则 b 节点需要向右移动</span>
<span class="line"><span class="token operator">===</span>第二轮遍历结束<span class="token operator">===</span></span>
<span class="line"></span>
<span class="line">最终 acd <span class="token number">3</span> 个节点都没有移动，b 节点被标记为移动</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/zhuanwan/blogs/edit/main/frame/React.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2022-10-19T10:03:01.000Z" data-allow-mismatch>2022/10/19 18:03</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: maniwu@aijiatui.com">wuhui</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: wu.hui@qkupower.com">wu.hui</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/blogs/frame/1_2_nextjs%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2.html" aria-label="1_2_nextjs项目部署"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">1_2_nextjs项目部署</span></div><!--]--></a><a class="route-link auto-link next" href="/blogs/frame/React%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html" aria-label="React使用中遇到的一些问题"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">React使用中遇到的一些问题</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blogs/assets/app-Cqb5tvJn.js" defer></script>
  </body>
</html>
